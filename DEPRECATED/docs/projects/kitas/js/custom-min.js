var icons=function(e,t){function a(e,t,a){}var r={},n={1:{2016:18634,n:"Mitte",id:0,fid:"01",all:363236,rel:.051299981279388604},2:{2016:14391,n:"Friedrichshain-Kreuzberg",id:56,fid:"02",all:278393,rel:.05169311009975107},3:{2016:22643,n:"Pankow",id:96,fid:"03",all:389976,rel:.058062547438816746},4:{2016:13249,n:"Charlottenburg-Wilmersdorf",id:160,fid:"04",all:330468,rel:.04009162763111708},5:{2016:11981,n:"Spandau",id:241,fid:"05",all:234630,rel:.051063376379832076},6:{2016:12966,n:"Steglitz - Zehlendorf",id:294,fid:"06",all:299765,rel:.04325388220772939},7:{2016:15456,n:"Tempelhof - Schöneberg",id:348,fid:"07",all:341161,rel:.045304123273176004},8:{2016:16470,n:"Neukölln",id:397,fid:"08",all:328062,rel:.05020392486786034},9:{2016:12436,n:"Treptow - Köpenick",id:452,fid:"09",all:253333,rel:.04908953827570826},10:{2016:13926,n:"Marzahn - Hellersdorf",id:512,fid:"10",all:259373,rel:.053691016412656674},11:{2016:14887,n:"Lichtenberg",id:559,fid:"11",all:275142,rel:.05410660677032223},12:{2016:12639,n:"Reinickendorf",id:610,fid:"12",all:256617,rel:.049252387799717086}},l=null,d={},o=.058062547438816746,s=22643,c=11,f=10,p=5,u=20,h=3,x=15,y=1,g=50,v=137,m=112,b=912,M=508,w=e.append("svg").attr("width",912).attr("height",508).attr("preserveAspectRatio","xMidYMid meet").attr("viewBox","0 0 912 508").append("g").attr("transform","translate(10,10)"),K={0:{x:2,y:1},56:{x:3,y:1},96:{x:3,y:0},160:{x:1,y:1},241:{x:0,y:1},294:{x:1,y:2},348:{x:2,y:2},397:{x:3,y:2},452:{x:4,y:2},512:{x:5,y:1},559:{x:4,y:1},610:{x:2,y:0}};return d3.selectAll("#icon_controlls .db").on("click",function(){d3.selectAll("#icon_controlls .db").classed("active",!1),d3.select(this).classed("active",!0).attr("class").indexOf("right")>=0?r.set(0):r.set(1)}),r.draw=function(){for(var e in n){var t=w.append("g").attr("transform","translate("+152*K[n[e].id].x+","+157*K[n[e].id].y+")"),a=[];t.append("text").attr("dy",10).text(n[e].n);var l=t.append("g").attr("transform","translate(0,30)");for(i=0;i<50;i++)a.push(l.append("image").attr("xlink:href","./images/Icon-"+(i%2==0?"male":"female")+".png").attr("width",11).attr("height",20).attr("x",14*(i-10*Math.floor(i/10))).attr("y",23*Math.floor(i/10)).style("opacity",.2));n[e].label=t.append("text").attr("dy",22).style("opacity",.5).text((50*n[e].rel).toFixed(2)),n[e].icons=a}r.animate()},r.set=function(e){y=e,r.animate()},r.animate=function(){for(var e in n){if(0==y){d3.select("#icon_controlls .def").text("entspricht ca. "+Math.round(452.86)+("en"==t?" Children between the age of 1 and 6 years":" Kindern im Alter von 1 bis 6 Jahren"));var a=n[e][2016]/s*50;n[e].label.text(n[e][2016]+("en"==t?" Children":" Kinder"))}else{d3.select("#icon_controlls .def").text("en"==t?"equals about 453 children between the age of 1 and 6 years":"entspricht einem Kind im Alter von 1 bis 6 Jahren pro 50 Einwohner");var a=50*n[e].rel;n[e].label.text((50*n[e].rel).toFixed(2)+("en"==t?" Children":" Kinder")),a--}for(var r=0;r<a;r++)n[e].icons[r].transition().duration(500).style("opacity",1);for(a!=Math.round(a)&&(n[e].icons[r].transition().duration(500).style("opacity",.8*(a-Math.floor(a))+.2),r++),r=r;r<50;r++)n[e].icons[r].transition().duration(500).style("opacity",.2)}},r.update=function(){},r.draw(),r},map=function(e,t){var a={},r,n,i=850,l=700,d,o=d3.scaleLinear().domain([0,200]).range([1,5]),s=e.append("svg").attr("width",850).attr("height",700).attr("viewBox","0 0 850 700").attr("preserveAspectRatio","xMinYMin meet"),c=s.append("g"),f=d3.geoMercator().center([13.43,52.51]).scale(7e4).translate([425,350]);return s.append("text").text("en"==t?"Berlin's Kitas, circle radius refers to size of Kita":"Berlins Kitas: der Radius der Kreise deutet die Größe der Kitas an.").attr("text-anchor","middle").style("font-family","Arial").style("font-size",10).attr("y",680).attr("x",425),d3.queue().defer(d3.json,"./data/Bezirk.topojson").defer(d3.csv,"./data/locations.csv").await(function(e,t,i){e&&console.log(e),n=i,r=t,n.forEach(function(e,t){var a=f([e.alon,e.alat]);n[t].px=a[0],n[t].py=a[1]}),a.buildMap()}),a.buildMap=function(){var e=topojson.feature(r,r.objects.Bezirk).features,t=d3.geoPath().projection(f);c.selectAll("path").data(e).enter().append("path").attr("d",t),d=c.selectAll("circle").data(n).enter().append("circle").attr("cx",function(e){return e.px}).attr("cy",function(e){return e.py}).attr("r",function(e){return 1+o(e.all)})},a.update=function(){},a};
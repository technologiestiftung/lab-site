"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),t}var Radarchart=function(){function t(e,a){_classCallCheck(this,t),this.width=a.width,this.container=a.container,this.height=a.height,this.levels=a.levels,this.radius=a.radius,this.factor=a.factor,this.type=a.type,this.config=a,this.margin=a.margin,this.max_value=a.max_value,this.factor_legend=a.factor_legend,this.station_name,this.tooltip,this.month_dict,this.month_dict_long,this.all_axis_week,this.circles={},this.updateCount=0,this.areas={},this.category,this.titleName,this.year,this.colorMax,this.colorMean,this.range,this.defs,this.week_dict_long,this.days_dict={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6},this.file=e,this.local_max,this.value_metric,this.radians=-2*Math.PI,this.segmentsWrapper,this.nodesWrapper,this.areasWrapper,this.data,this.svg,this.all_axis_month,this.all_axis_week,this.all_axis_hour,this.axis,this.title,this.total,this.node_coords={median:[],max:[]},this.init=this.init.bind(this),this.createSegments=this.createSegments.bind(this),this.createAxis=this.createAxis.bind(this),this.createCircles=this.createCircles.bind(this),this.createAreas=this.createAreas.bind(this),this.createGraphics=this.createGraphics.bind(this),this.createTitle=this.createTitle.bind(this),this.updateTooltip=this.updateTooltip.bind(this),this.updateCircles=this.updateCircles.bind(this),this.updateGraphics=this.updateGraphics.bind(this),this.calcMaxLocal=this.calcMaxLocal.bind(this),this.highlightMonths=this.highlightMonths.bind(this),this.unhighlightMonths=this.unhighlightMonths.bind(this),this.highlightAll=this.highlightAll.bind(this),this.unhighlightAll=this.unhighlightAll.bind(this),this.mergeHours=this.mergeHours.bind(this)}return _createClass(t,[{key:"init",value:function(t,e){var a=[{sum:0,max:0,median:0}];this.type=this.config.type,"Woche"==this.type?(null!=this.file[0]?this.data=this.file[0].days:this.data=a,config.max_value=1e4):"Wochentage"==this.type?(null!=this.file[0]?this.data=this.file[0].hoursWeekdays:this.data=a,config.max_value=800):"Monat"==this.type?(null!=this.file[0]?this.data=this.file[0].months:this.data=a,config.max_value=1e4):"Wochenenden"==this.type&&(null!=this.file[0]?this.data=this.file[0].hoursWeekends:this.data=a,config.max_value=800),this.station_name=e,this.value_metric=config.value_metric,this.all_axis_month=[0,1,2,3,4,5,6,7,8,9,10,11],this.all_axis_week=[0,1,2,3,4,5,6],this.all_axis_hour=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],this.year=config.year,"Woche"==this.type?(this.total=this.all_axis_week.length,this.all_axis=this.all_axis_week):"Wochentage"==this.type||"Wochenenden"==this.type?(this.total=this.all_axis_hour.length,this.all_axis=this.all_axis_hour):"Monat"==this.type&&(this.total=this.all_axis_month.length,this.all_axis=this.all_axis_month),this.colorMax="#3ce39f",this.colorMean="#2824b2",this.max_local=this.calcMaxLocal(this.data),"Relativ Max"==this.value_metric?this.max_value=this.max_local.max:"Relativ Median"==this.value_metric?this.max_value=this.max_local.median:"Absolut"==this.value_metric&&(this.max_value=config.max_value),this.svg=d3.select("svg.wrapper-".concat(t)).on("mouseover",function(t,e){d3.selectAll(".median-area").style("opacity",.8),d3.selectAll(".max-area").style("opacity",.8),d3.selectAll(".median-circle").style("opacity",1),d3.selectAll(".max-circle").style("opacity",1)}).on("mouseout",function(t,e){d3.selectAll(".median-area").style("opacity",.8),d3.selectAll(".max-area").style("opacity",.8),d3.selectAll(".median-circle").style("opacity",1),d3.selectAll(".max-circle").style("opacity",1)}),this.defs=this.svg.append("defs").append("mask").attr("id","chart_mask-".concat(t)),this.defs.append("circle").attr("cx",this.width/2+this.margin.left).attr("cy",this.height/2+this.margin.top).attr("r",this.width/2).style("fill","white").style("stroke","black").style("stroke-width","1px"),this.segmentsWrapper=this.svg.append("g").classed("segments-wrapper",!0),this.areasWrapper=this.svg.append("g").classed("areas-wrapper",!0).attr("mask","url(#chart_mask-".concat(t,")")),this.nodesWrapper=this.svg.append("g").classed("nodes-wrapper",!0).attr("mask","url(#chart_mask-".concat(t,")")),this.title=this.svg.append("g").classed("title-wrapper",!0),this.createSegments(),this.createTitle()}},{key:"mergeHours",value:function(t){return t[0].hours.map(function(t,e){return t[0]})}},{key:"createSegments",value:function(){for(var t=this,e=function(e){var a=t.factor*Math.min(t.width/2,t.height/2),i=t.factor*a*((e+1)/t.levels);t.segmentsWrapper.selectAll(".levels").data(t.all_axis).enter().append("svg:line").attr("x1",function(e,a){return i*(t.factor*Math.sin(a*t.radians/t.total+Math.PI))}).attr("y1",function(e,a){return i*(t.factor*Math.cos(a*t.radians/t.total+Math.PI))}).attr("x2",function(e,a){return i*(t.factor*Math.sin((a+1)*t.radians/t.total+Math.PI))}).attr("y2",function(e,a){return i*(t.factor*Math.cos((a+1)*t.radians/t.total+Math.PI))}).attr("class","line").style("stroke","#E0E0E0").style("stroke-opacity","1px").style("stroke-width","1px").attr("transform","translate( ".concat(t.width/2+t.margin.left,", ").concat(t.height/2+t.margin.top,")"))},a=0;a<this.levels;a++)e(a);this.createAxis()}},{key:"createAxis",value:function(){var t,e,a=this;this.month_dict={0:"Jan",1:"Feb",2:"Mär",3:"Apr",4:"Mai",5:"Jun",6:"Jul",7:"Aug",8:"Sep",9:"Okt",10:"Nov",11:"Dez"},this.month_dict_long={0:"Januar",1:"Februar",2:"März",3:"April",4:"Mai",5:"Juni",6:"Juli",7:"August",8:"September",9:"Oktober",10:"November",11:"Dezember"},this.day_dict={0:"24",1:"01",2:"02",3:"03",4:"04",5:"05",6:"06",7:"07",8:"08",9:"09",10:"10",11:"11",12:"12",13:"13",14:"14",15:"15",16:"16",17:"17",18:"18",19:"19",20:"20",21:"21",22:"22",23:"23",24:"24"},this.week_dict={0:"So",1:"Mo",2:"Di",3:"Mi",4:"Do",5:"Fr",6:"Sa"},this.week_dict_long={0:"Sonntage",1:"Montage",2:"Dienstage",3:"Mittwoche",4:"Donnerstage",5:"Freitage",6:"Samstage"},"Woche"==this.type?(t=this.all_axis_week,e=this.week_dict):"Monat"==this.type?(t=this.all_axis,e=this.month_dict):"Wochentage"!=this.type&&"Wochenenden"!=this.type||(t=this.all_axis_hour,e=this.day_dict),this.axis=this.segmentsWrapper.selectAll(".axis").data(t).enter().append("g").classed("axis",!0),this.axis.append("line").attr("x1",this.margin.left).attr("y1",this.margin.top).attr("x2",function(t,e){return a.width/2*(a.factor*Math.sin(e*a.radians/a.total+Math.PI))+a.margin.left}).attr("y2",function(t,e){return a.height/2*(a.factor*Math.cos(e*a.radians/a.total+Math.PI))+a.margin.top}).attr("class","line").style("stroke","#E0E0E0").style("stroke-width","1px").attr("transform","translate( ".concat(this.width/2,", ").concat(this.height/2,")")),this.axis.append("text").text(function(t,a){return e[t]}).attr("text-anchor","middle").attr("class",function(t,e){return"legend-".concat(e," legend")}).attr("id",function(t,e){return e}).attr("x",function(t,e){return a.width/2*(a.factor*Math.sin(e*a.radians/a.total+Math.PI))+a.factor*Math.sin(e*a.radians/a.total+Math.PI)*13+a.margin.left}).style("z-index",1e8).attr("y",function(t,e){return a.height/2*(a.factor*Math.cos(e*a.radians/a.total+Math.PI))+a.factor*Math.cos(e*a.radians/a.total+Math.PI)*13+a.margin.top+4}).attr("transform","translate(".concat(this.width/2,", ").concat(this.height/2,")")).on("mouseover",function(t,e){a.updateTooltip(t,e),a.highlightMonths(a.data,a.category,e)}).on("mouseout",function(t,e){a.tooltip.attr("style","display: none"),a.unhighlightMonths(t,a.category,e)}),this.createGraphics()}},{key:"createCircles",value:function(t,e){this.node_coords[t]=[],this.circles[t]=this.nodesWrapper.selectAll(".".concat(t,"-circle")),this.updateCircles(t,e),this.createAreas(this.node_coords[t],e,t)}},{key:"createAreas",value:function(t,e,a){this.areas[a]=this.areasWrapper.selectAll(".".concat(a,"-area")),this.updateAreas(this.node_coords[a],e,a)}},{key:"createGraphics",value:function(){this.createCircles("max",this.colorMax),this.createCircles("median",this.colorMean)}},{key:"createTitle",value:function(){var t=this;d3.json("../assets/names_dict.json").then(function(e){t.titleName=e[t.station_name],t.title.append("text").text(t.titleName).classed("title",!0)}).catch(function(t){throw t}),this.svg.select(".title-wrapper").style("transform","translateY(".concat(this.height+this.margin.top+this.margin.bottom-10,"px) translateX(").concat((this.width+this.margin.left+this.margin.right)/2,"px)"))}},{key:"updateTooltip",value:function(t,e){var a=window.innerWidth,i=window.innerHeight;if(null!=this.data[t]){var s,h=d3.event.pageX+10,l=d3.event.pageY+10;a-h<150&&(h=d3.event.pageX-175),i-l<150&&(l=d3.event.pageY-125),console.log(this.type),s="Wochentage"==this.type||"Wochenenden"==this.type?this.day_dict[e]+" Uhr":"Woche"==this.type?this.week_dict_long[e]:this.month_dict_long[e],this.tooltip=d3.select("#tooltip"),null!=this.data[t]&&(d3.select(".station-wrapper").text(this.titleName),d3.select(".month-wrapper").text(s),d3.select(".year-wrapper").text(this.year),d3.select("#median-value").text(this.data[t].median).style("color",this.colorMean),d3.select("#max-value").text(this.data[t].max).style("color",this.colorMax),d3.select("#total-value").text(this.data[t].sum),7==this.data.length||24==this.data.length?d3.select(".total").style("display","none"):d3.select(".total").style("display","flex")),"Wochentage"!=this.type&&"Wochenenden"!=this.type||d3.select(".year-wrapper").style("display","none"),this.tooltip.attr("style","left: ".concat(h,"px; top: ").concat(l,"px; position: absolute")).classed("active",!0)}}},{key:"updateGraphics",value:function(t,e){this.type=e.type,this.range=e.range,this.value_metric=e.value_metric;var a=[{sum:0,max:0,median:0}];"Woche"==this.type?(null!=t[0]?this.data=t[0].days:this.data=a,config.max_value=1e4):"Wochentage"==this.type?(null!=t[0]?this.data=t[0].hoursWeekdays:this.data=a,config.max_value=800):"Monat"==this.type?(null!=t[0]?this.data=t[0].months:this.data=a,config.max_value=1e4):"Wochenenden"==this.type&&(null!=t[0]?this.data=t[0].hoursWeekends:this.data=a,config.max_value=800),this.max_local=this.calcMaxLocal(this.data),"Relativ Max"==this.value_metric?this.max_value=this.max_local.max:"Relativ Median"==this.value_metric?this.max_value=this.max_local.median:"Absolut"==this.value_metric&&(this.max_value=config.max_value),this.updateCircles("median","#00ffa2"),this.updateCircles("max","#004466")}},{key:"calcMaxLocal",value:function(t){var e={min:[],max:[],mean:[],median:[]};for(var a in t.forEach(function(t){e.min.push(t.min),e.max.push(t.max),e.mean.push(t.mean),e.median.push(t.median)}),e)e[a]=d3.max(e[a]);return e}},{key:"updateAreas",value:function(t,e,a){this.areas[a]=this.areasWrapper.selectAll(".".concat(a,"-area")).data([t]),this.areas[a].exit().remove(),this.areas[a]=this.areas[a].enter().append("polygon").classed("".concat(a,"-area"),!0).style("stroke-width","1px").style("stroke",e).style("fill",e).style("fill-opacity",.75).merge(this.areas[a]),this.areas[a].transition().duration(500).attr("points",function(t){for(var e="",a=0;a<t.length;a++)e=e+t[a][0]+","+t[a][1]+" ";return e}).attr("transform","translate( ".concat(this.width/2+this.margin.left-this.factor,", ").concat(this.height/2+this.margin.top-this.factor,")"))}},{key:"highlightMonths",value:function(t,e,a){t.month;d3.selectAll(".legend").classed("highlighted",function(e){return null!=t.month?e==t.month:a==e}).classed("hovered",!1),d3.selectAll(".mean-circle").classed("highlighted",function(t,e){return t.month==a}),d3.selectAll(".max-circle").classed("highlighted",function(t,e){return t.month==a})}},{key:"highlightAll",value:function(t){d3.selectAll(".legend").classed("highlighted",!1),d3.selectAll(".wrapper-".concat(t)).selectAll(".legend").classed("hovered",!0)}},{key:"unhighlightAll",value:function(t){d3.selectAll(".wrapper-".concat(t)).selectAll(".legend").classed("hovered",!1)}},{key:"unhighlightMonths",value:function(t,e,a){t.month;d3.selectAll(".legend").classed("highlighted",function(e){return t.month,!1}),d3.selectAll(".mean-circle").classed("highlighted",function(t,e){return t.month,!1}),d3.selectAll(".max-circle").classed("highlighted",function(t,e){return t.month,!1})}},{key:"updateCircles",value:function(t,e){var a=this;this.node_coords={median:[],max:[]},this.category=t,this.circles[t]=this.nodesWrapper.selectAll(".".concat(t,"-circle")).data(this.data),this.circles[t].exit().remove(),this.circles[t]=this.circles[t].enter().append("svg:circle").classed("".concat(t,"-circle"),!0).attr("class",function(e,a){return"".concat(t,"-circle circle-").concat(a)}).attr("fill",e).attr("r",this.radius).on("mouseover",function(e,i){a.updateTooltip(e),a.highlightMonths(e,t,i)}).on("mouseout",function(e,i){a.tooltip.attr("style","display: none"),a.unhighlightMonths(e,t,i)}).merge(this.circles[t]),this.circles[t].transition().duration(500).attr("cx",function(e,i){if(null!=e){var s=a.width/2*(e[t]/a.max_value)*a.factor*Math.sin(i*a.radians/a.total+Math.PI),h=a.height/2*(e[t]/a.max_value)*a.factor*Math.cos(i*a.radians/a.total+Math.PI);s=isNaN(s)?0:s,h=isNaN(h)?0:h;var l=[];return l.push(s),l.push(h),a.node_coords[t].push(l),s}}).attr("cy",function(e,i){if(null!=e){var s=a.height/2*(e[t]/a.max_value)*a.factor*Math.cos(i*a.radians/a.total+Math.PI);return s=isNaN(s)?0:s}}).attr("transform","translate( ".concat(this.width/2+this.margin.left-this.factor,", ").concat(this.height/2+this.margin.top-this.factor,")")),this.updateAreas(this.node_coords[t],e,t)}}]),t}();
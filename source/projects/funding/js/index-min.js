"use strict";function relative(t,e,n){return Math.abs((t/e*100).toFixed(n))}Number.prototype.map=function(t,e,n,a){return(this-t)*(a-n)/(e-t)+n};var numberFormat=function(t){var e=t.toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),e.join(".")},Chart=function(t,e){var n,a,r,o,c,s,i,l,u,d,p,h,g,f,m,v,y,x,b,w,M=!1,A=!0,_="moneyAbsolute",R=["btn_money_abs","btn_count_abs","btn_money_rel","btn_count_rel"],Y=[],k=1,B=1,F=[2009,2010,2011,2012,2013,2014,2015,2016,2017],I={top:50,bottom:17,left:0,right:10},S={moneyRelative:[{pos:{start:22,end:63},content:["2011 fließt der größte Anteil","aller Förderungen des Jahres","mit mehr als 25% in","den Bereich Forschung."]}],moneyAbsolute:[{pos:{start:15,end:75},content:["Mehr als 60% aller Zu-","wendungen fließen an die ","BVG und die S-Bahn."]}],countRelative:[{pos:{start:50,end:142},content:["Im Sektor Arbeit werden","vergleichsweise viele","Projekte gefördert. Die Anzahl","sinkt tendenziell. Dafür werden","größere Summen gefördert."]}],countAbsolute:[{pos:{start:297,end:185},content:["2016 wurde die erste Förderung","im Bereich Tierschutz bewilligt."]}]},P={svg:{width:1e3,height:1e3,maxRad:16e3,minRad:9},legend:{width:700},data:{relative:!0}},q={moneyAbsolute:"Kreisfläche: Volumen aller Zuwendungen in Euro",moneyRelative:"Kreisfläche: Volumen in % pro Jahr",countRelative:"Kreisfläche: Anzahl in % pro Jahr",countAbsolute:"Kreisfläche: Anzahl d. Zuwendungen pro Jahr."},E={moneyAbsolute:[{pos:.05,content:"125 Mio.",posY:0},{pos:.25,content:"0.5 Mrd.",posY:0},{pos:.5,content:"1.0 Mrd.",posY:0},{pos:.75,content:"1.5 Mrd.",posY:0},{pos:1,content:"2 Mrd.",posY:0}],moneyRelative:[{pos:.05,content:"5%",posY:0},{pos:.25,content:"25%",posY:0},{pos:.5,content:"50%",posY:0},{pos:.75,content:"75%",posY:0},{pos:1,content:"100%",posY:0}],countAbsolute:[{pos:.05,content:"300",posY:0},{pos:.25,content:"1200",posY:0},{pos:.5,content:"2400",posY:0},{pos:.75,content:"3600",posY:0},{pos:1,content:"4900",posY:0}],countRelative:[{pos:.05,content:"5%",posY:0},{pos:.25,content:"25%",posY:0},{pos:.5,content:"50%",posY:0},{pos:.75,content:"75%",posY:0},{pos:1,content:"100%",posY:0}]},C=v().angle(Math.PI/4).x(function(t){return t[0]}).y(function(t){return t[1]});function j(t){e.select(".legend-wrapper").remove();var n=P.svg.maxRad;e.select("#legend-title").text(q[t]);var a=document.querySelector(".project-text");if(console.log(a.getBoundingClientRect()),y>750){(p=c.append("svg").classed("legend-wrapper",!0).attr("height",150).attr("width",700)).append("defs").append("clipPath").attr("id","cut-off-bottom").append("rect").attr("width",700).attr("height",92).attr("x",0).attr("y",0);p.append("line").attr("x1",0).attr("y1",93).attr("x2",700).attr("y2",93).attr("stroke","grey").attr("stroke-width",1),p.selectAll("circles").data(E[t]).enter().append("circle").attr("clip-path","url(#cut-off-bottom)").attr("cx",function(t,e){return 1.5*e*100+16}).attr("cy",95).attr("r",function(t){return Math.sqrt(t.pos*n/Math.PI)}),p.selectAll("annotations").data(E[t]).enter().append("text").classed("annotation",!0).attr("x",function(t,e){return 1.53*e*100}).attr("y",function(t,e){return 120}).text(function(t){return t.content})}y<750&&((p=c.append("svg").classed("legend-wrapper",!0).attr("height",120).attr("width",P.legend.width)).selectAll("circles").data(E[t]).enter().append("circle").attr("cx",72).attr("cy",120).attr("r",function(e,a){var r=Math.sqrt(e.pos*n/Math.PI);return E[t][a].posY=r,r}),p.selectAll("lines").data(E[t]).enter().append("line").attr("x1",72).attr("y1",function(t){return 121-t.posY}).attr("x2",172).attr("y2",function(t){return 121-t.posY}).attr("stroke-width",.5).attr("stroke","black").classed("legend-line",!0),p.selectAll("text").data(E[t]).enter().append("text").classed("annotation",!0).attr("x",182).attr("y",function(t){return 125-t.posY}).text(function(t){return t.content}))}function A(t,e){var n;return function(){return t&&(n=t.apply(e||this,arguments),t=null),n}}function z(){document.getElementById("svg-wrapper").getBoundingClientRect();var t=document.getElementById("chart").getBoundingClientRect(),e=document.querySelector(".labels").getBoundingClientRect(),a=document.querySelector("#legend").getBoundingClientRect(),c=t.width-e.width;P.svg.width=c,P.legend.width=a.width,function(){var t=1,e=1,a=P.svg.width-I.left-I.right;n.attr("width",P.svg.width).attr("height",P.svg.height),o.attr("cx",function(t,e){var n=a/(F.length-1)*e+1;return n}).attr("cy",function(n,a){return 8===a?(e=t,t+=1,(P.svg.height-I.top-I.bottom)/29*e):(P.svg.height-I.top-I.bottom)/29*t}),g.range([0,a]),h.scale(g),n.select(".x.axis").call(h),r.attr("transform","translate("+I.left+","+I.top+")"),j(_),V(_)}(),j(_)}function J(t){R.forEach(function(t){e.select("#".concat(t)).classed("active",!1)}),e.select(t).classed("button active",!0)}function K(){e.select(this).classed("active",!1),e.select('svg[id="svg-wrapper"]').selectAll("circle").style("opacity",1);var t=e.select(this).attr("id");e.select("#label-".concat(t)).classed("label-active",!1),m.classed("active",!1)}function L(t,n){e.select('svg[id="svg-wrapper"]').selectAll("circle").style("opacity",.3),e.selectAll('circle[id="'.concat(this.id,'"]')).style("opacity",1),e.select(this).classed("active",!0);var a=e.select(this).attr("id");e.select("#label-".concat(a)).classed("label-active",!0),function(t,n){if((m=e.select("#tooltip")).classed("active",!0),y>600){var a=e.event.pageX+10,r=e.event.pageY+10;y-a<260&&(a=e.event.pageX-280),m.style("left","".concat(a,"px")).style("top","".concat(r,"px"))}var o=e.select("#count_value"),c=e.select("#money_value"),s=e.select("#date"),i=e.select("#category_title"),l=e.select(n).attr("data-year"),u=e.select(n).attr("id");i.text(Y[u-1]),s.text(F[l]),o.text("".concat(numberFormat(t.count))),c.text("".concat(numberFormat(t.money)," € (").concat(t.moneyShare,"%)"))}(t,this)}function V(a){e.selectAll(".swoopy_canvas").remove(),e.selectAll(".annotation").remove(),e.selectAll(".arrow").remove(),(y=t.innerWidth)>600&&S[a].forEach(function(t){x=Math.abs(e.select("circle[data-uid='".concat(t.pos.start,"']")).attr("cx")),b=Math.abs(e.select("circle[data-uid='".concat(t.pos.end,"']")).attr("cx"))+I.right+15,w=Math.abs(e.select("circle[data-uid='".concat(t.pos.start,"']")).attr("cy"))+I.top,i=Math.abs(e.select("circle[data-uid='".concat(t.pos.end,"']")).attr("cy"))+I.top+15,v=n.append("path").attr("class","arrow").attr("marker-end","url(#arrowhead)").datum([[b,i],[x,w]]).attr("d",C),n.append("rect").classed("swoopy_canvas",!0).attr("x",b).attr("y",i+5).attr("width","250px").attr("height","85px").style("fill","#FFFFFF").style("opacity",".9"),n.append("text").classed("annotation",!0).attr("x",b+10).attr("y",i+10).selectAll("tSpan").data(t.content).enter().append("tspan").attr("x",b+10).attr("dy",function(t,e){return"".concat(1.2,"em")}).text(function(t){return t})})}function v(){var t=Math.PI,e=!0,n=function(t){return t[0]},a=function(t){return t[1]};function r(r){var c=o((r=r.map(function(t,e){return[n.call(r,t,e),a.call(r,t,e)]}))[1][0]-r[0][0],r[1][1]-r[0][1]),s=o(c/(2*Math.tan(t/2)),c/2);return"M "+r[0][0]+","+r[0][1]+" a "+s+","+s+" 0 0,"+(e?"1":"0")+" "+(r[1][0]-r[0][0])+","+(r[1][1]-r[0][1])}function o(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}return r.angle=function(e){return arguments.length?(t=Math.min(Math.max(e,1e-6),Math.PI-1e-6),r):t},r.clockwise=function(t){return arguments.length?(e=!!t,r):e},r.x=function(t){return arguments.length?(n=t,r):n},r.y=function(t){return arguments.length?(a=t,r):a},r}e.json("../data/politikbereich.json",function(t){l=t,m=e.select("#tooltip");var i=[];l.forEach(function(t){Y.push(t.target),t.years.forEach(function(t){i.push(t)})});var p=[],v=[];i.forEach(function(t){v.push(t.money),p.push(t.count)}),a=e.select("#chart"),c=e.select("#legend"),d=e.extent(p),s=e.extent(v),d=e.extent(l,function(t){return t.count}),f=e.extent(F),g=e.scaleLinear().domain(f).range([0,P.svg.width-I.left-I.right]),h=e.axisBottom(g).ticks(8).tickFormat(e.format("d")),j("moneyAbsolute"),a.append("div").classed("labels",!0).selectAll("sectorLabel").data(l).enter().append("p").classed("copy xs label",!0).attr("id",function(t,e){return"label-".concat(e+1)}).attr("style","width: 150px").text(function(t){return t.target}),(n=a.append("svg").attr("id","svg-wrapper").attr("width",P.svg.width).attr("height",P.svg.height)).append("g").classed("x axis",!0),n.select(".x.axis").append("g").attr("transform","translate(".concat(I.left,", 0)")).call(h),n.append("marker").attr("id","arrowhead").attr("viewBox","-10 -10 20 20").attr("refX",0).attr("refY",0).attr("markerWidth",20).attr("markerHeight",20).attr("stroke-width",1).attr("orient","auto").append("polyline").attr("stroke-linejoin","bevel").attr("points","-6.75,-6.75 0,0 -6.75,6.75"),r=n.selectAll("chartCategory").data(l).enter().append("g").classed("category",!0),u=r.selectAll("circles").data(function(t){return t.years}).enter().append("g").classed("circle",!0),o=u.append("circle").attr("data-uid",function(t,e){var n="".concat(B).concat(e);return 8===e&&(B+=1),n}).attr("id",function(t,e){return e<8?"".concat(k):8==e?(k+=1,"".concat(k-1)):void 0}).classed("value",!0).attr("data-year",function(t,e){return e}).attr("r",1).on("mouseover",L).on("mouseout",K),M=!0,z()}),e.select("#btn_money_abs").on("click",function(){V(_="moneyAbsolute"),console.log("inside"),o.transition().duration(750).attr("r",function(t){var e=t.money.map(s[0],s[1],P.svg.minRad,P.svg.maxRad),n=Math.sqrt(e/Math.PI);return 0===t.money?0:n}).attr("class","circle-money"),j(_),J("#btn_money_abs")}),e.select("#btn_money_rel").on("click",function(){V(_="moneyRelative"),o.transition().duration(750).attr("r",function(t){var e=t.moneyShare.map(0,100,P.svg.minRad,P.svg.maxRad),n=Math.sqrt(e/Math.PI);return 0===t.moneyShare?0:n}).attr("class","circle-count"),j(_),J("#btn_money_rel")}),e.select("#btn_count_rel").on("click",function(){V(_="countRelative"),o.transition().duration(750).attr("r",function(t){var e=t.countShare.map(0,100,P.svg.minRad,P.svg.maxRad),n=Math.sqrt(e/Math.PI);return 0===t.countShare?0:n}).attr("class","circle-count"),j(_),J("#btn_count_rel")}),e.select("#btn_count_abs").on("click",function(){V(_="countAbsolute"),o.transition().duration(750).attr("r",function(t){var e=t.count.map(d[0],d[1],P.svg.minRad,P.svg.maxRad),n=Math.sqrt(e/Math.PI);return 0===t.count?0:n}).attr("class","circle-count"),j(_),J("#btn_count_abs")}),t.addEventListener("scroll",function(t){M&&(e.select(".project").node().getBoundingClientRect().top<-300&&A&&(A=!1,o.transition().duration(1e3).attr("r",function(t){var e=t.money.map(s[0],s[1],P.svg.minRad,P.svg.maxRad),n=Math.sqrt(e/Math.PI);return 0===t.money?0:n})))}),t.addEventListener("resize",function(t){z()})}(window,d3);
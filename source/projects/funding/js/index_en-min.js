"use strict";function relative(t,e,n){return Math.abs((t/e*100).toFixed(n))}Number.prototype.map=function(t,e,n,a){return(this-t)*(a-n)/(e-t)+n};var numberFormat=function(t){var e=t.toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),e.join(".")},Chart=function(t,e){var n,a,r,o,c,s,i,l,u,d,p,h,g,m,f,v,y,b,x,w,M=!1,A=!0,_="moneyAbsolute",R=["btn_money_abs","btn_count_abs","btn_money_rel","btn_count_rel"],Y=[],k=1,S=1,C=[2009,2010,2011,2012,2013,2014,2015,2016,2017],F={top:50,bottom:17,left:0,right:10},B={moneyRelative:[{pos:{start:22,end:63},content:["In 2011, more than 25% of the","year's total funding was","spent on research."]}],moneyAbsolute:[{pos:{start:15,end:75},content:["More than 60% of all awards","go to the BVG and S-Bahn."]}],countRelative:[{pos:{start:50,end:142},content:['Projects in the "Work" category',"receive relatively more funding.","The number of funded projects is","sinking, but the value of the grants","is increasing."]}],countAbsolute:[{pos:{start:297,end:185},content:["The first funding for animal","protection was granted in 2016."]}]},E={Verkehr:"Traffic",Forschung:"Research",Wirtschaft:"Economy",Kultur:"Culture",Arbeit:"Work",Jugend:"Youth",Wissenschaft:"Science",Soziales:"Social",Gesundheit:"Health",Sport:"Sport",Stadtentwicklung:"Urban development",Bildung:"Education",Frauen:"Women",Umwelt:"Environment",Integration:"Integration",Finanzen:"Finance","Bauen, Wohnen":"Construction, Housing",Denkmalschutz:"Preservation",Gleichstellung:"Gender equality","Kirchengem.":"Church",Justiz:"Justice",Antidiskriminierung:"Anti-discrimination","Sicherheit, Ordnung":"Security, Order",Verbraucherschutz:"Consumer protection",Familie:"Family",Europa:"Europe",Pflege:"Care","Bürger-Engagement":"Civic engagement",Tierschutz:"Animal protection"},I={svg:{width:1e3,height:1e3,maxRad:16e3,minRad:9},legend:{width:700},data:{relative:!0}},P={moneyAbsolute:"Circular area: Volume of all grants in euros",moneyRelative:"Circular area: Volume in % per year",countRelative:"Circular area: Number in % per year",countAbsolute:"Circular area: Number of grants per year."},q={moneyAbsolute:[{pos:.05,content:"125 Mio.",posY:0},{pos:.25,content:"0.5 Mrd.",posY:0},{pos:.5,content:"1.0 Mrd.",posY:0},{pos:.75,content:"1.5 Mrd.",posY:0},{pos:1,content:"2 Mrd.",posY:0}],moneyRelative:[{pos:.05,content:"5%",posY:0},{pos:.25,content:"25%",posY:0},{pos:.5,content:"50%",posY:0},{pos:.75,content:"75%",posY:0},{pos:1,content:"100%",posY:0}],countAbsolute:[{pos:.05,content:"300",posY:0},{pos:.25,content:"1200",posY:0},{pos:.5,content:"2400",posY:0},{pos:.75,content:"3600",posY:0},{pos:1,content:"4900",posY:0}],countRelative:[{pos:.05,content:"5%",posY:0},{pos:.25,content:"25%",posY:0},{pos:.5,content:"50%",posY:0},{pos:.75,content:"75%",posY:0},{pos:1,content:"100%",posY:0}]},W=v().angle(Math.PI/4).x(function(t){return t[0]}).y(function(t){return t[1]});function j(t){e.select(".legend-wrapper").remove();var n=I.svg.maxRad;if(e.select("#legend-title").text(P[t]),y>750){(p=c.append("svg").classed("legend-wrapper",!0).attr("height",150).attr("width",700)).append("defs").append("clipPath").attr("id","cut-off-bottom").append("rect").attr("width",700).attr("height",92).attr("x",0).attr("y",0);p.append("line").attr("x1",0).attr("y1",93).attr("x2",700).attr("y2",93).attr("stroke","grey").attr("stroke-width",1),p.selectAll("circles").data(q[t]).enter().append("circle").attr("clip-path","url(#cut-off-bottom)").attr("cx",function(t,e){return 1.53*e*100+16}).attr("cy",95).attr("r",function(t){return Math.sqrt(t.pos*n/Math.PI)}),p.selectAll("annotations").data(q[t]).enter().append("text").classed("annotation",!0).attr("x",function(t,e){return 1.53*e*100}).attr("y",function(t,e){return 120}).text(function(t){return t.content})}y<750&&((p=c.append("svg").classed("legend-wrapper",!0).attr("height",120).attr("width",I.legend.width)).selectAll("circles").data(q[t]).enter().append("circle").attr("cx",72).attr("cy",120).attr("r",function(e,a){var r=Math.sqrt(e.pos*n/Math.PI);return q[t][a].posY=r,r}),p.selectAll("lines").data(q[t]).enter().append("line").attr("x1",72).attr("y1",function(t){return 121-t.posY}).attr("x2",172).attr("y2",function(t){return 121-t.posY}).attr("stroke-width",.5).attr("stroke","black").classed("legend-line",!0),p.selectAll("text").data(q[t]).enter().append("text").classed("annotation",!0).attr("x",182).attr("y",function(t){return 125-t.posY}).text(function(t){return t.content}))}function A(t,e){var n;return function(){return t&&(n=t.apply(e||this,arguments),t=null),n}}function z(){document.getElementById("svg-wrapper").getBoundingClientRect();var t=document.getElementById("chart").getBoundingClientRect(),e=document.querySelector(".labels").getBoundingClientRect(),a=document.querySelector("#legend").getBoundingClientRect(),c=t.width-e.width;I.svg.width=c,I.legend.width=a.width,function(){var t=1,e=1,a=I.svg.width-F.left-F.right;n.attr("width",I.svg.width).attr("height",I.svg.height),o.attr("cx",function(t,e){var n=a/(C.length-1)*e+1;return n}).attr("cy",function(n,a){return 8===a?(e=t,t+=1,(I.svg.height-F.top-F.bottom)/29*e):(I.svg.height-F.top-F.bottom)/29*t}),g.range([0,a]),h.scale(g),n.select(".x.axis").call(h),r.attr("transform","translate("+F.left+","+F.top+")"),j(_),T(_)}(),j(_)}function V(t){R.forEach(function(t){e.select("#".concat(t)).classed("active",!1)}),e.select(t).classed("button active",!0)}function G(){e.select(this).classed("active",!1),e.select('svg[id="svg-wrapper"]').selectAll("circle").style("opacity",1);var t=e.select(this).attr("id");e.select("#label-".concat(t)).classed("label-active",!1),f.classed("active",!1)}function L(t,n){e.select('svg[id="svg-wrapper"]').selectAll("circle").style("opacity",.3),e.selectAll('circle[id="'.concat(this.id,'"]')).style("opacity",1),e.select(this).classed("active",!0);var a=e.select(this).attr("id");e.select("#label-".concat(a)).classed("label-active",!0),function(t,n){if((f=e.select("#tooltip")).classed("active",!0),y>600){var a=e.event.pageX+10,r=e.event.pageY+10;y-a<260&&(a=e.event.pageX-280),f.style("left","".concat(a,"px")).style("top","".concat(r,"px"))}var o=e.select("#count_value"),c=e.select("#money_value"),s=e.select("#date"),i=e.select("#category_title"),l=e.select(n).attr("data-year"),u=e.select(n).attr("id");i.text(E[Y[u-1]]),s.text(C[l]),o.text("".concat(numberFormat(t.count))),c.text("".concat(numberFormat(t.money)," € (").concat(t.moneyShare,"%)"))}(t,this)}function T(a){e.selectAll(".swoopy_canvas").remove(),e.selectAll(".annotation").remove(),e.selectAll(".arrow").remove(),(y=t.innerWidth)>600&&B[a].forEach(function(t){b=Math.abs(e.select("circle[data-uid='".concat(t.pos.start,"']")).attr("cx")),x=Math.abs(e.select("circle[data-uid='".concat(t.pos.end,"']")).attr("cx"))+F.right+15,w=Math.abs(e.select("circle[data-uid='".concat(t.pos.start,"']")).attr("cy"))+F.top,i=Math.abs(e.select("circle[data-uid='".concat(t.pos.end,"']")).attr("cy"))+F.top+15,v=n.append("path").attr("class","arrow").attr("marker-end","url(#arrowhead)").datum([[x,i],[b,w]]).attr("d",W),n.append("rect").classed("swoopy_canvas",!0).attr("x",x).attr("y",i+5).attr("width","250px").attr("height","85px").style("fill","#FFFFFF").style("opacity",".9"),n.append("text").classed("annotation",!0).attr("x",x+10).attr("y",i+10).selectAll("tSpan").data(t.content).enter().append("tspan").attr("x",x+10).attr("dy",function(t,e){return"".concat(1.2,"em")}).text(function(t){return t})})}function v(){var t=Math.PI,e=!0,n=function(t){return t[0]},a=function(t){return t[1]};function r(r){var c=o((r=r.map(function(t,e){return[n.call(r,t,e),a.call(r,t,e)]}))[1][0]-r[0][0],r[1][1]-r[0][1]),s=o(c/(2*Math.tan(t/2)),c/2);return"M "+r[0][0]+","+r[0][1]+" a "+s+","+s+" 0 0,"+(e?"1":"0")+" "+(r[1][0]-r[0][0])+","+(r[1][1]-r[0][1])}function o(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}return r.angle=function(e){return arguments.length?(t=Math.min(Math.max(e,1e-6),Math.PI-1e-6),r):t},r.clockwise=function(t){return arguments.length?(e=!!t,r):e},r.x=function(t){return arguments.length?(n=t,r):n},r.y=function(t){return arguments.length?(a=t,r):a},r}e.json("../data/politikbereich.json",function(t){l=t,f=e.select("#tooltip");var i=[];l.forEach(function(t){Y.push(t.target),t.years.forEach(function(t){i.push(t)})});var p=[],v=[];i.forEach(function(t){v.push(t.money),p.push(t.count)}),a=e.select("#chart"),c=e.select("#legend"),d=e.extent(p),s=e.extent(v),d=e.extent(l,function(t){return t.count}),m=e.extent(C),g=e.scaleLinear().domain(m).range([0,I.svg.width-F.left-F.right]),h=e.axisBottom(g).ticks(8).tickFormat(e.format("d")),j("moneyAbsolute"),a.append("div").classed("labels",!0).selectAll("sectorLabel").data(l).enter().append("p").classed("copy xs label",!0).attr("id",function(t,e){return"label-".concat(e+1)}).attr("style","width: 150px").text(function(t){return E[t.target]}),(n=a.append("svg").attr("id","svg-wrapper").attr("width",I.svg.width).attr("height",I.svg.height)).append("g").classed("x axis",!0),n.select(".x.axis").append("g").attr("transform","translate(".concat(F.left,", 0)")).call(h),n.append("marker").attr("id","arrowhead").attr("viewBox","-10 -10 20 20").attr("refX",0).attr("refY",0).attr("markerWidth",20).attr("markerHeight",20).attr("stroke-width",1).attr("orient","auto").append("polyline").attr("stroke-linejoin","bevel").attr("points","-6.75,-6.75 0,0 -6.75,6.75"),r=n.selectAll("chartCategory").data(l).enter().append("g").classed("category",!0),u=r.selectAll("circles").data(function(t){return t.years}).enter().append("g").classed("circle",!0),o=u.append("circle").attr("data-uid",function(t,e){var n="".concat(S).concat(e);return 8===e&&(S+=1),n}).attr("id",function(t,e){return e<8?"".concat(k):8==e?(k+=1,"".concat(k-1)):void 0}).classed("value",!0).attr("data-year",function(t,e){return e}).attr("r",1).on("mouseover",L).on("mouseout",G),M=!0,z()}),e.select("#btn_money_abs").on("click",function(){T(_="moneyAbsolute"),console.log("inside"),o.transition().duration(750).attr("r",function(t){var e=t.money.map(s[0],s[1],I.svg.minRad,I.svg.maxRad),n=Math.sqrt(e/Math.PI);return 0===t.money?0:n}).attr("class","circle-money"),j(_),V("#btn_money_abs")}),e.select("#btn_money_rel").on("click",function(){T(_="moneyRelative"),o.transition().duration(750).attr("r",function(t){var e=t.moneyShare.map(0,100,I.svg.minRad,I.svg.maxRad),n=Math.sqrt(e/Math.PI);return 0===t.moneyShare?0:n}).attr("class","circle-count"),j(_),V("#btn_money_rel")}),e.select("#btn_count_rel").on("click",function(){T(_="countRelative"),o.transition().duration(750).attr("r",function(t){var e=t.countShare.map(0,100,I.svg.minRad,I.svg.maxRad),n=Math.sqrt(e/Math.PI);return 0===t.countShare?0:n}).attr("class","circle-count"),j(_),V("#btn_count_rel")}),e.select("#btn_count_abs").on("click",function(){T(_="countAbsolute"),o.transition().duration(750).attr("r",function(t){var e=t.count.map(d[0],d[1],I.svg.minRad,I.svg.maxRad),n=Math.sqrt(e/Math.PI);return 0===t.count?0:n}).attr("class","circle-count"),j(_),V("#btn_count_abs")}),t.addEventListener("scroll",function(t){M&&(e.select(".project").node().getBoundingClientRect().top<-300&&A&&(A=!1,o.transition().duration(1e3).attr("r",function(t){var e=t.money.map(s[0],s[1],I.svg.minRad,I.svg.maxRad),n=Math.sqrt(e/Math.PI);return 0===t.money?0:n})))}),t.addEventListener("resize",function(t){z()})}(window,d3);